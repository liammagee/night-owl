<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com https://cdn.tailwindcss.com 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        font-src 'self' data:;
        img-src 'self' data: https: http: blob:;
        connect-src 'self';
        worker-src 'self' blob:;
    ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NightOwl - Philosophical Writing & Teaching</title>
    <link rel="icon" type="image/png" href="build/icon.png">
    <link rel="icon" type="image/svg+xml" href="build/icon.svg">
    
    <!-- Styles -->
    <link rel="stylesheet" href="orchestrator/style.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/modes.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/speaker-notes.css">
    <link rel="stylesheet" href="css/preview-presentation.css">
    <link rel="stylesheet" href="css/search.css">
    <link rel="stylesheet" href="css/interactions.css">
    <link rel="stylesheet" href="css/gamification.css">
    
    <!-- Scripts -->
    <script id="marked-script" src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams'
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'a'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- D3.js v7.8.5 (local copy) for visualizations and whole/part diagrams -->
    <script src="lib/d3.min.js"></script>
    <!-- Babel no longer needed - using pre-compiled components -->
    <style>
        /* Tailwind-inspired utility classes for presentation view */
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .h-screen { height: 100vh; }
        .bg-gray-900 { background-color: #1a1a1a; }
        .bg-gray-800 { background-color: #2d2d2d; }
        .bg-gray-700 { background-color: #404040; }
        .bg-gray-600 { background-color: #525252; }
        .bg-blue-600 { background-color: #16a34a; }
        .bg-blue-700 { background-color: #15803d; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-green-700 { background-color: #15803d; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-red-700 { background-color: #b91c1c; }
        .bg-blue-500 { background-color: #22c55e; }
        .bg-cream { background-color: #fefdfb; }
        .text-white { color: white; }
        .text-gray-900 { color: #1a1a1a; }
        .text-gray-600 { color: #525252; }
        .text-sm { font-size: 0.875rem; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .top-4 { top: 1rem; }
        .left-4 { left: 1rem; }
        .right-4 { right: 1rem; }
        .bottom-4 { bottom: 1rem; }
        .bottom-8 { bottom: 2rem; }
        .z-50 { z-index: 50; }
        .left-1\/2 { left: 50%; }
        .z-10 { z-index: 10; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-items: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-1 { gap: 0.25rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-8 { padding: 2rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-0\.75 { margin-bottom: 0.1875rem; }
        .mb-0\.5 { margin-bottom: 0.125rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-full { border-radius: 9999px; }
        .cursor-pointer { cursor: pointer; }
        .cursor-grab { cursor: grab; }
        .overflow-hidden { overflow: hidden; }
        .transform { transform: var(--tw-transform); }
        .-translate-x-1\/2 { --tw-translate-x: -50%; transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .transition-colors { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-300 { transition-duration: 300ms; }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .shadow-purple-500\/50 { box-shadow: 0 25px 50px -12px rgba(168, 85, 247, 0.5); }
        .hover\:bg-blue-700:hover { background-color: #15803d; }
        .hover\:bg-gray-600:hover { background-color: #525252; }
        .hover\:bg-green-700:hover { background-color: #15803d; }
        .hover\:bg-red-700:hover { background-color: #b91c1c; }
        .hover\:shadow-3xl:hover { box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.3); }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .disabled\:bg-gray-800:disabled { background-color: #2d2d2d; }
        .disabled\:opacity-50:disabled { opacity: 0.5; }
        .active\:cursor-grabbing:active { cursor: grabbing; }
        .border { border-width: 1px; }
        .border-gray-600 { border-color: #525252; }
        .focus\:border-blue-500:focus { border-color: #22c55e; }
        .outline-none { outline: 2px solid transparent; outline-offset: 2px; }
        .ring-4 { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5); }
        .ring-blue-500 { --tw-ring-color: #22c55e; }
        .ring-purple-500 { --tw-ring-color: #a855f7; }
        .w-2 { width: 0.5rem; }
        .h-2 { height: 0.5rem; }
        .min-h-400 { min-height: 25rem; }
        
        /* Mode button styling */
        .mode-btn {
            transition: all 0.2s ease;
        }
        
        .mode-btn:hover {
            background: #f0f0f0 !important;
        }
        
        .mode-btn.active {
            background: #16a34a !important;
            color: white !important;
        }
        
        /* Network visualization styles */
        #network-canvas svg {
            cursor: grab;
        }
        
        #network-canvas svg:active {
            cursor: grabbing;
        }
        
        /* Custom titlebar removed - using native window frame */
        
        /* View containers use full height with native titlebar */
        .view-container {
            height: 100vh;
            margin-top: 0px;
            top: 0px;
            position: absolute;
            width: 100%;
        }
        
        /* Fix mode button highlighting */
        .mode-btn.active {
            background: #16a34a !important;
            color: white !important;
        }
        
        .mode-btn:not(.active) {
            background: transparent !important;
            color: #666 !important;
        }
        
        /* Add margins to sidebar headers */
        #structure-pane-header {
            padding: 8px 12px !important;
            margin-top: 4px !important;
        }
        
        #structure-pane-title {
            margin-left: 0 !important;
            margin-top: 4px !important;
        }
        
        /* File tree styling improvements */
        #file-tree-view {
            padding: 8px 12px !important;
            margin-top: 4px !important;
        }
        
        /* Remove all bullet points from file tree */
        #file-tree-view ul {
            list-style: none !important;
            padding-left: 0 !important;
            margin: 0 !important;
        }
        
        #file-tree-view li {
            list-style: none !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
        }
        
        /* Proper indentation for nested items */
        #file-tree-view ul.file-tree-children {
            padding-left: 20px !important;
        }
        
        /* Ensure root folder has no indentation */
        #file-tree-view ul.file-tree-root {
            padding-left: 0 !important;
        }

        /* File tree item styling */
        .file-tree-item {
            display: flex;
            align-items: center;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
            cursor: pointer;
            user-select: none;
            font-size: 13px;
            line-height: 1.4;
        }

        .file-tree-item:hover {
            background-color: #f0f0f0;
        }

        body.dark-mode .file-tree-item:hover {
            background-color: #404040;
        }

        .file-tree-item.folder {
            font-weight: 500;
        }

        .file-tree-item.file {
            font-weight: normal;
        }

        .file-tree-item .expand-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 12px;
            height: 12px;
        }

        .file-tree-item .file-icon {
            margin-right: 6px;
            font-size: 12px;
        }

        .file-tree-item .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* File tree main content */
        .file-tree-main {
            display: flex;
            align-items: center;
        }

        /* File tags display */
        .file-tags {
            margin-top: 2px;
            margin-left: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 10px;
            opacity: 0.7;
        }

        .file-tag {
            background: var(--primary-500);
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 500;
            display: inline-block;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        body.dark-mode .file-tag {
            background: var(--primary-600);
            color: var(--neutral-100);
        }

        .file-tree-item:hover .file-tags {
            opacity: 1;
        }

        /* Tag search interface */
        #tag-search-input {
            transition: border-color 0.2s;
        }

        #tag-search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 1px var(--primary-500);
        }

        body.dark-mode #tag-search-input {
            background: var(--neutral-800);
            border-color: var(--neutral-600);
            color: var(--text-color);
        }

        body.dark-mode #tag-search-input:focus {
            border-color: var(--primary-500);
        }

        /* Tag filter chips */
        .tag-chip {
            background: var(--primary-100);
            color: var(--primary-700);
            border: 1px solid var(--primary-300);
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tag-chip:hover {
            background: var(--primary-200);
        }

        .tag-chip.active {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        .tag-chip-remove {
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            line-height: 1;
        }

        body.dark-mode .tag-chip {
            background: var(--primary-900);
            color: var(--primary-200);
            border-color: var(--primary-700);
        }

        body.dark-mode .tag-chip:hover {
            background: var(--primary-800);
        }

        body.dark-mode .tag-chip.active {
            background: var(--primary-600);
            color: white;
        }

        /* Status bar styling */
        #editor-status-bar {
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        
        /* Dark mode status bar */
        body.dark-mode #editor-status-bar {
            background: #2d2d2d !important;
            border-top-color: #444 !important;
            color: #ccc !important;
        }

        /* Internal link styling (Obsidian-style) */
        .internal-link {
            color: #6366f1 !important;
            text-decoration: none !important;
            background: rgba(99, 102, 241, 0.1) !important;
            padding: 2px 4px !important;
            border-radius: 3px !important;
            border: 1px solid rgba(99, 102, 241, 0.2) !important;
            transition: all 0.2s ease !important;
            cursor: pointer !important;
        }

        .internal-link:hover {
            background: rgba(99, 102, 241, 0.2) !important;
            border-color: rgba(99, 102, 241, 0.4) !important;
            text-decoration: none !important;
        }

        /* Dark mode internal links */
        body.dark-mode .internal-link {
            color: #8b5cf6 !important;
            background: rgba(139, 92, 246, 0.15) !important;
            border-color: rgba(139, 92, 246, 0.3) !important;
        }

        body.dark-mode .internal-link:hover {
            background: rgba(139, 92, 246, 0.25) !important;
            border-color: rgba(139, 92, 246, 0.5) !important;
        }

        /* Find & Replace Dialog */
        #find-replace-dialog {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: #fefdfb;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 16px;
            min-width: 320px;
            font-size: 14px;
        }

        #find-replace-dialog.hidden {
            display: none;
        }

        body.dark-mode #find-replace-dialog {
            background: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }

        .find-replace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .find-replace-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode .find-replace-close {
            color: #ccc;
        }

        .find-replace-close:hover {
            color: #333;
        }

        body.dark-mode .find-replace-close:hover {
            color: white;
        }

        .find-replace-field {
            margin-bottom: 8px;
        }

        .find-replace-field label {
            display: block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #666;
        }

        body.dark-mode .find-replace-field label {
            color: #ccc;
        }

        .find-replace-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        body.dark-mode .find-replace-input {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        .find-replace-input:focus {
            outline: none;
            border-color: #16a34a;
        }

        .find-replace-options {
            display: flex;
            gap: 12px;
            margin: 12px 0;
            font-size: 12px;
        }

        .find-replace-option {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .find-replace-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .find-replace-btn {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #333;
        }

        .find-replace-btn:hover {
            background: #e9ecef;
        }

        .find-replace-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        body.dark-mode .find-replace-btn {
            background: #404040;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .find-replace-btn:hover:not(:disabled) {
            background: #4a4a4a;
        }

        .find-replace-primary {
            background: #16a34a;
            color: white;
            border-color: #16a34a;
        }

        .find-replace-primary:hover:not(:disabled) {
            background: #005a9e;
        }

        .find-replace-stats {
            font-size: 11px;
            color: #666;
            margin-top: 8px;
        }

        body.dark-mode .find-replace-stats {
            color: #aaa;
        }

        /* Monaco Editor Search Highlights */
        .monaco-editor .findMatch {
            background-color: rgba(234, 92, 0, 0.33);
        }

        .monaco-editor .currentFindMatch {
            background-color: rgba(234, 92, 0, 0.66);
        }

        /* Folder Name Dialog */
        #folder-name-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #folder-name-modal.hidden {
            display: none;
        }

        .folder-name-dialog {
            background: #fefdfb;
            border-radius: 8px;
            padding: 24px;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .folder-name-dialog {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .folder-name-header {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #333;
        }

        body.dark-mode .folder-name-header {
            color: #e0e0e0;
        }

        .folder-name-field {
            margin-bottom: 20px;
        }

        .folder-name-field label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: #555;
        }

        body.dark-mode .folder-name-field label {
            color: #ccc;
        }

        .folder-name-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        body.dark-mode .folder-name-input {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        .folder-name-input:focus {
            outline: none;
            border-color: #16a34a;
        }

        .folder-name-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .folder-name-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .folder-name-btn:hover {
            background: #e9ecef;
        }

        body.dark-mode .folder-name-btn {
            background: #404040;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .folder-name-btn:hover {
            background: #4a4a4a;
        }

        .folder-name-btn.primary {
            background: #16a34a;
            color: white;
            border-color: #16a34a;
        }

        .folder-name-btn.primary:hover {
            background: #005a9e;
        }

        .folder-name-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Custom Title Bar -->
    <!-- Custom titlebar removed - using native window controls -->
    
    <!-- Main Application Container -->
    <div id="app-container">
        <!-- Left Sidebar (Always visible) -->
        <div id="left-sidebar">
            <div id="structure-pane-header">
                <div class="toggle-buttons structure-toggle-buttons">
                    <button id="show-files-btn" class="btn pane-toggle-button" title="Show File Tree">Files</button>
                    <button id="show-structure-btn" class="btn pane-toggle-button active" title="Show Document Structure">Structure</button>
                </div>
                <!-- Tag search interface (only visible in Files view) -->
                <div id="tag-search-section" style="display: none; margin-top: 4px;">
                    <input type="text" id="tag-search-input" placeholder="Search files by tags..." style="width: 100%; padding: 4px 8px; border: 1px solid var(--neutral-300); border-radius: 4px; font-size: 11px; background: var(--neutral-0);">
                    <div id="tag-filter-chips" style="margin-top: 4px; display: flex; flex-wrap: wrap; gap: 4px; min-height: 20px;"></div>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 4px;">
                    <h2 id="structure-pane-title">Structure</h2>
                    <div style="display: flex; gap: 4px;">
                        <button id="change-directory-btn" class="btn" title="Change Working Directory" style="display: none; padding: 4px 8px; font-size: 11px;">üìÅ Directory</button>
                        <button id="new-folder-btn" class="btn" title="Create New Folder" style="padding: 4px 8px; font-size: 11px;">+ Folder</button>
                    </div>
                </div>
            </div>
            <div style="flex: 1; overflow-y: auto;">
                <ul id="structure-list"></ul>
                <div id="file-tree-view" style="display: none;"></div>
                <!-- TEMP DEBUG: Test button -->
            </div>
        </div>

        <!-- Resizer for left sidebar -->
        <div id="sidebar-resizer" class="resizer" style="width: 4px; cursor: ew-resize; background: #ddd;"></div>

        <!-- Main Content Area (Switches between editor and presentation) -->
        <div id="main-content">
            <!-- Content Mode Switcher -->
            <div id="mode-switcher" style="height: 40px; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: space-between; background: #f8f9fa; padding: 0 16px;">
                <!-- Navigation Controls -->
                <div id="navigation-controls" style="display: flex; align-items: center; gap: 4px;">
                    <button id="nav-back-btn" class="nav-btn" title="Go Back (Alt+Left)" disabled style="padding: 6px 10px; border: 1px solid #ccc; background: #fefdfb; border-radius: 4px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                        ‚Üê Back
                    </button>
                    <button id="nav-forward-btn" class="nav-btn" title="Go Forward (Alt+Right)" disabled style="padding: 6px 10px; border: 1px solid #ccc; background: #fefdfb; border-radius: 4px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                        Forward ‚Üí
                    </button>
                    <div style="width: 1px; height: 20px; background: #ccc; margin: 0 8px;"></div>
                    <span id="current-file-name" style="font-size: 11px; color: #666; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        No file selected
                    </span>
                </div>
                
                <!-- Mode Switcher -->
                <div style="display: flex; gap: 4px; padding: 4px; background: #fefdfb; border: 1px solid #ddd; border-radius: 6px;">
                    <button id="editor-mode-btn" class="mode-btn active" style="padding: 6px 16px; border: none; background: #16a34a; color: white; border-radius: 4px; cursor: pointer; font-size: 12px;">Editor</button>
                    <button id="presentation-mode-btn" class="mode-btn" style="padding: 6px 16px; border: none; background: transparent; color: #666; border-radius: 4px; cursor: pointer; font-size: 12px;">Presentation</button>
                    <button id="network-mode-btn" class="mode-btn" style="padding: 6px 16px; border: none; background: transparent; color: #666; border-radius: 4px; cursor: pointer; font-size: 12px;">Network</button>
                    <button id="circle-mode-btn" class="mode-btn" style="padding: 6px 16px; border: none; background: transparent; color: #666; border-radius: 4px; cursor: pointer; font-size: 12px;">Circle</button>
                </div>
                
                <!-- Pane Toggle Controls -->
                <div style="display: flex; gap: 4px; align-items: center;">
                    <span style="font-size: 11px; color: #666; margin-right: 4px;">Panes:</span>
                    <button id="toggle-sidebar-btn" class="btn" title="Toggle Files/Structure Pane" style="padding: 4px 8px; font-size: 11px; background: #16a34a; color: white; border-radius: 3px;">üìÅ</button>
                    <button id="toggle-editor-btn" class="btn" title="Toggle Editor Pane" style="padding: 4px 8px; font-size: 11px; background: #16a34a; color: white; border-radius: 3px;">üìù</button>
                    <button id="toggle-preview-btn" class="btn" title="Toggle Preview Pane" style="padding: 4px 8px; font-size: 11px; background: #16a34a; color: white; border-radius: 3px;">üëÅ</button>
                    <button id="toggle-gamification-btn" class="btn" title="Toggle Writing Stats Panel" style="padding: 4px 8px; font-size: 11px; background: #f59e0b; color: white; border-radius: 3px;">üéÆ</button>
                </div>
            </div>

            <!-- Editor Content -->
            <div id="editor-content" class="content-view active">
                <!-- Editor Toolbar (spans both editor and preview panes) -->
                <div id="editor-toolbar">
                        <!-- Markdown Formatting Tools -->
                        <button id="format-bold-btn" class="toolbar-btn toolbar-btn-bold" title="Bold (Ctrl+B)">
                            B
                        </button>
                        <button id="format-italic-btn" class="toolbar-btn toolbar-btn-italic" title="Italic (Ctrl+I)">
                            I
                        </button>
                        <button id="format-code-btn" class="toolbar-btn toolbar-btn-code" title="Inline Code (Ctrl+`)">
                            &lt;&gt;
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="format-h1-btn" class="toolbar-btn toolbar-btn-bold" title="Heading 1">
                            H1
                        </button>
                        <button id="format-h2-btn" class="toolbar-btn toolbar-btn-bold" title="Heading 2">
                            H2
                        </button>
                        <button id="format-h3-btn" class="toolbar-btn toolbar-btn-bold" title="Heading 3">
                            H3
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="format-list-btn" class="toolbar-btn" title="Bulleted List">
                            ‚Ä¢
                        </button>
                        <button id="format-numbered-list-btn" class="toolbar-btn" title="Numbered List">
                            1.
                        </button>
                        <button id="format-quote-btn" class="toolbar-btn" title="Blockquote">
                            &gt;
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="format-inline-math-btn" class="toolbar-btn toolbar-btn-code" title="Inline Math ($...$)">
                            $x$
                        </button>
                        <button id="format-display-math-btn" class="toolbar-btn toolbar-btn-code" title="Display Math ($$...$$)">
                            $$
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="format-link-btn" class="toolbar-btn" title="Insert Link (Ctrl+K)">
                            üîó
                        </button>
                        <button id="format-image-btn" class="toolbar-btn" title="Insert Image">
                            üñºÔ∏è
                        </button>
                        <button id="format-table-btn" class="toolbar-btn" title="Insert Table">
                            üìä
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="auto-slide-markers-btn" class="toolbar-btn" title="Add Slide Markers to Paragraphs">
                            üìÑ‚Üí
                        </button>
                        <button id="remove-slide-markers-btn" class="toolbar-btn" title="Remove All Slide Markers">
                            üìÑ‚úñÔ∏è
                        </button>
                        <button id="insert-speaker-notes-btn" class="toolbar-btn" title="Insert Speaker Notes Template">
                            üìù
                        </button>
                        <button id="insert-toc-btn" class="toolbar-btn" title="Insert Table of Contents">
                            üìë+
                        </button>
                        <button id="remove-toc-btn" class="toolbar-btn" title="Remove Table of Contents">
                            üìë‚úñÔ∏è
                        </button>
                        
                        <div class="toolbar-separator"></div>
                        
                        <button id="command-palette-btn" class="toolbar-btn" title="Command Palette (Cmd+Shift+P)">
                            üéØ
                        </button>
                        
                        <!-- Annotation Controls -->
                        <div class="toolbar-separator"></div>
                        <button id="insert-comment-annotation-btn" class="toolbar-btn" title="Insert Comment Annotation">
                            üí¨
                        </button>
                        <button id="insert-highlight-annotation-btn" class="toolbar-btn" title="Insert Highlight Annotation">
                            üü°
                        </button>
                        <button id="insert-block-annotation-btn" class="toolbar-btn" title="Insert Block Annotation">
                            üìã
                        </button>
                        
                        <div class="toolbar-separator"></div>
                        <span style="font-size: 11px; color: #666;">Format</span>
                        <div class="toolbar-separator"></div>
                        <button id="fold-all-btn" class="toolbar-btn" title="Fold All Sections (Ctrl+K, Ctrl+0)">
                            üìÅ
                        </button>
                        <button id="unfold-all-btn" class="toolbar-btn" title="Unfold All Sections (Ctrl+K, Ctrl+J)">
                            üìÇ
                        </button>
                        <button id="fold-current-btn" class="toolbar-btn" title="Fold Current Section (Ctrl+Shift+[)">
                            ‚¨áÔ∏è
                        </button>
                        <button id="unfold-current-btn" class="toolbar-btn" title="Unfold Current Section (Ctrl+Shift+])">
                            ‚¨ÜÔ∏è
                        </button>
                        <div class="toolbar-separator"></div>
                        <button id="global-search-btn" class="toolbar-btn" title="Global Search (Ctrl+Shift+F)">
                            üîç
                        </button>
                        <button id="ai-todo-suggestions-btn" class="toolbar-btn" title="Get AI TODO Suggestions">
                            ü§ñ
                        </button>
                        <button id="invoke-ash-btn" class="toolbar-btn" title="Invoke Ash (AI Writing Companion) - Cmd+Shift+'">
                            üí¨
                        </button>
                </div>
                <!-- Container for editor and preview panes -->
                <div id="panes-container" style="display: flex; flex: 1; overflow: hidden;">
                    <div id="editor-pane">
                        <div id="editor-container" style="width: 100%; flex: 1;"></div>
                        <textarea id="fallback-editor" style="display: none; width: 100%; flex: 1; box-sizing: border-box; border: 1px solid #ccc; font-family: monospace; padding: 5px;"></textarea>
                        <!-- Status Bar -->
                        <div id="editor-status-bar" style="height: 24px; background: #f8f9fa; border-top: 1px solid #ddd; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; font-size: 12px; color: #666; flex-shrink: 0;">
                            <div id="status-left" style="display: flex; align-items: center; gap: 12px;">
                                <span id="word-count">Words: 0</span>
                                <span id="char-count">Characters: 0</span>
                                <span id="line-count">Lines: 1</span>
                            </div>
                            <div id="status-right" style="display: flex; align-items: center; gap: 12px;">
                                <span id="cursor-position">Ln 1, Col 1</span>
                                <span id="file-status">Markdown (.md)</span>
                            </div>
                        </div>
                    </div>
                    <div id="resizer" class="resizer" style="width: 4px; cursor: ew-resize; background: #ddd;"></div>
                    <div id="right-pane">
                    <div class="toggle-buttons" style="padding: 8px; border-bottom: 1px solid #ddd; flex-shrink: 0;">
                        <button id="show-preview-btn" class="btn pane-toggle-button active">Preview</button>
                        <button id="show-chat-btn" class="btn pane-toggle-button">AI Chat</button>
                        <button id="show-search-btn" class="btn pane-toggle-button">Search</button>
                        <button id="show-speaker-notes-btn" class="btn pane-toggle-button">üìù Notes</button>
                        <button id="show-wholepart-btn" class="btn pane-toggle-button">üîó Relations</button>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                        <div id="preview-pane" class="content-pane">
                            <div id="preview-content"></div>
                        </div>
                        <div id="chat-pane" class="content-pane terminal-chat" style="display: none;">
                            <div class="terminal-header">
                                <span class="terminal-subtitle" id="chat-context-display">Your AI writing companion ‚Ä¢ Type /help for commands</span>
                            </div>
                            <div id="chat-messages" class="terminal-output" style="flex: 1; overflow-y: auto; margin-bottom: 16px;"></div>
                            <div class="terminal-input-area" style="display: flex; align-items: center; gap: 8px;">
                                <span class="terminal-prompt-line">
                                    <span class="terminal-user">you</span><span class="terminal-separator">:</span> 
                                </span>
                                <input type="text" id="chat-input" class="terminal-input" placeholder="Ask Ash anything about your writing..." style="flex: 1;">
                                <div class="terminal-buttons" style="display: flex; gap: 4px;">
                                    <button id="restart-chat-btn" class="btn btn-small" title="Start new chat session">üîÑ</button>
                                    <button id="load-editor-to-chat-btn" class="btn btn-small" title="Load current editor content into chat">üìù</button>
                                    <button id="copy-ai-response-btn" class="btn btn-small" title="Insert last AI response at cursor position">üìã</button>
                                </div>
                            </div>
                        </div>
                        <div id="search-pane" class="content-pane" style="display: none; height: 100%; padding: 12px; flex-direction: column;">
                            <!-- Global Search and Replace Interface -->
                            <div class="search-controls" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px;">
                                <div style="padding: 8px; background: #f0f7ff; border-radius: 4px; margin-bottom: 8px; font-size: 12px; color: #0066cc;">
                                    üí° <strong>Tip:</strong> Search will include tags, metadata (title, category, description), and file content. Click on tags in results to filter files.
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="text" id="global-search-input" placeholder="Search in all files, tags, and metadata..." style="flex: 1; padding: 6px; border: 1px solid #ccc; border-radius: 3px;">
                                    <button id="global-search-execute" class="btn" title="Execute Search">Search</button>
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="text" id="global-replace-input" placeholder="Replace with..." style="flex: 1; padding: 6px; border: 1px solid #ccc; border-radius: 3px;">
                                    <button id="global-replace-execute" class="btn" title="Replace All Matches" style="background: #dc3545; color: white;">Replace All</button>
                                    <button id="global-replace-preview" class="btn" title="Preview Replacements">Preview</button>
                                </div>
                                <div class="search-options" style="display: flex; gap: 12px; font-size: 12px;">
                                    <label style="display: flex; align-items: center; gap: 4px;">
                                        <input type="checkbox" id="search-case-sensitive"> Case Sensitive
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 4px;">
                                        <input type="checkbox" id="search-whole-word"> Whole Word
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 4px;">
                                        <input type="checkbox" id="search-regex"> Regex
                                    </label>
                                </div>
                                <div class="search-file-types" style="display: flex; gap: 8px; align-items: center; font-size: 12px;">
                                    <span>Files:</span>
                                    <input type="text" id="search-file-pattern" placeholder="*.md, *.txt" style="flex: 1; padding: 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 11px;">
                                </div>
                            </div>
                            
                            <!-- Search Results -->
                            <div class="search-results-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 4px 0; border-bottom: 1px solid #eee;">
                                <span id="search-results-count" style="font-size: 12px; color: #666;">No search performed</span>
                                <button id="clear-search-results" class="btn" style="padding: 2px 6px; font-size: 11px;" title="Clear Results">Clear</button>
                            </div>
                            <div id="search-results" style="flex: 1; overflow-y: auto; font-size: 13px;"></div>
                        </div>
                        
                        <div id="speaker-notes-pane" class="content-pane" style="display: none; height: 100%; padding: 12px; flex-direction: column;">
                            <!-- Speaker Notes Interface -->
                            <div class="speaker-notes-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #007bff;">
                                <h3 style="margin: 0; color: #007bff; font-size: 16px;">üìù Speaker Notes</h3>
                                <button id="toggle-speaker-notes-in-preview" class="btn" style="padding: 4px 8px; font-size: 11px;" title="Toggle Notes in Preview">Show in Preview</button>
                            </div>
                            
                            <div id="speaker-notes-content" style="flex: 1; overflow-y: auto; font-size: 14px; line-height: 1.6;">
                                <p style="color: #666; text-align: center; padding: 20px;">
                                    No speaker notes found.<br>
                                    <small>Add notes using <code>```notes</code> blocks in your Markdown.</small>
                                </p>
                            </div>
                            
                            <div class="speaker-notes-help" style="margin-top: 12px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                                <strong>Tip:</strong> Use <code>```notes</code> in your Markdown to add speaker notes that won't appear on slides.
                            </div>
                        </div>

                        <div id="wholepart-pane" class="content-pane" style="display: none; height: 100%; flex-direction: column;">
                            <!-- Whole/Part Relations Interface -->
                            <div class="wholepart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 12px; border-bottom: 2px solid #4ecdc4;">
                                <h3 style="margin: 0; color: #4ecdc4; font-size: 16px;">üîó Concept Relations</h3>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <select id="wholepart-visualization-type" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="0">Circular Ring</option>
                                        <option value="1">Center-Radial</option>
                                        <option value="2">Containment</option>
                                        <option value="3">Spiral Center</option>
                                        <option value="4">Spiral Parts</option>
                                        <option value="5">Dialectical</option>
                                        <option value="6">Spiral Radial</option>
                                        <option value="7">Fractal</option>
                                        <option value="8">Nested</option>
                                    </select>
                                    <button id="wholepart-refresh" class="btn" style="padding: 4px 8px; font-size: 11px;" title="Refresh Data">üîÑ</button>
                                </div>
                            </div>
                            
                            <div id="wholepart-description" style="padding: 8px 12px; background: #f8f9fa; border-radius: 4px; margin: 0 12px 12px 12px; font-size: 12px; color: #555;">
                                <strong>Visualization:</strong> <span id="wholepart-description-text">Select a visualization to explore concept relationships.</span>
                            </div>

                            <!-- Viewing Options -->
                            <div id="wholepart-viewing-options" style="margin: 0 12px 12px 12px; padding: 8px 12px; background: #fff; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 11px;">
                                <div style="margin-bottom: 8px; font-weight: bold; color: #4ecdc4;">Viewing Options:</div>
                                
                                <!-- Checkboxes -->
                                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 10px;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="wholepart-show-labels" style="margin-right: 4px;" checked>
                                        <span>Show Labels</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="wholepart-show-connections" style="margin-right: 4px;" checked>
                                        <span>Show Connections</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="wholepart-animate-transitions" style="margin-right: 4px;" checked>
                                        <span>Animate Transitions</span>
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="wholepart-dark-theme" style="margin-right: 4px;">
                                        <span>Dark Theme</span>
                                    </label>
                                </div>

                                <!-- Size Slider -->
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <label for="wholepart-size-slider" style="min-width: 60px;">Node Size:</label>
                                    <input type="range" id="wholepart-size-slider" min="0.1" max="3" step="0.1" value="1" style="flex: 1; min-width: 100px;">
                                    <span id="wholepart-size-value" style="min-width: 30px; text-align: center; color: #666;">1.0x</span>
                                </div>
                                
                                <!-- Opacity Slider -->
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label for="wholepart-opacity-slider" style="min-width: 60px;">Opacity:</label>
                                    <input type="range" id="wholepart-opacity-slider" min="0.1" max="1" step="0.1" value="1" style="flex: 1; min-width: 100px;">
                                    <span id="wholepart-opacity-value" style="min-width: 30px; text-align: center; color: #666;">100%</span>
                                </div>
                                
                                <!-- Spiral Tightness Slider (only visible for spiral views) -->
                                <div id="wholepart-spiral-controls" style="display: none; align-items: center; gap: 8px;">
                                    <label for="wholepart-spiral-slider" style="min-width: 60px;">Spiral:</label>
                                    <input type="range" id="wholepart-spiral-slider" min="0.5" max="4" step="0.1" value="2" style="flex: 1; min-width: 100px;">
                                    <span id="wholepart-spiral-value" style="min-width: 30px; text-align: center; color: #666;">2.0x</span>
                                </div>
                            </div>
                            
                            <div id="wholepart-visualization" style="flex: 1; overflow: hidden; margin: 0 12px; border: 1px solid #e0e0e0; border-radius: 4px; background: #fefdfb;">
                                <!-- D3 visualization will be rendered here -->
                            </div>
                            
                            <div class="wholepart-controls" style="display: flex; justify-content: center; gap: 6px; padding: 8px 8px; border-top: 1px solid #e0e0e0; flex-wrap: wrap;">
                                <button id="wholepart-animate" class="btn" style="padding: 4px 8px; font-size: 11px;">‚ñ∂Ô∏è Animate</button>
                                <button id="wholepart-reset" class="btn" style="padding: 4px 8px; font-size: 11px;">üîÑ Reset</button>
                                <button id="wholepart-export-png" class="btn" style="padding: 4px 8px; font-size: 11px; background: #4CAF50; color: white; border: 1px solid #45a049;">üì∏ Export</button>
                                <button id="wholepart-zoom-in" class="btn" style="padding: 4px 6px; font-size: 11px;">+</button>
                                <button id="wholepart-zoom-out" class="btn" style="padding: 4px 6px; font-size: 11px;">-</button>
                            </div>
                        </div>
                    </div>
                </div>
                </div> <!-- End panes-container -->
            </div>

            <!-- Presentation Content -->
            <div id="presentation-content" class="content-view" style="display: flex; flex-direction: column; position: relative;">
                <div id="presentation-export-controls" style="position: absolute; top: 10px; right: 10px; z-index: 1000;"></div>
                <div id="presentation-root" style="width: 100%; flex: 1; min-height: 0;"></div>
                <div id="speaker-notes-panel" style="display: none !important;">
                    <!-- Resize Handle -->
                    <div id="speaker-notes-resize-handle" style="position: absolute; top: 0; left: 0; right: 0; height: 8px; background: #34495e; cursor: ns-resize; border-radius: 4px 4px 0 0; display: flex; align-items: center; justify-content: center;">
                        <div style="width: 40px; height: 3px; background: #7f8c8d; border-radius: 2px;"></div>
                    </div>
                    <!-- Header -->
                    <div style="margin: 16px 16px 8px 16px; padding-top: 8px;">
                        <h4 style="margin: 0; font-size: 14px; color: #ecf0f1;">üìù Speaker Notes</h4>
                    </div>
                    <!-- Scrollable Content -->
                    <div id="current-slide-notes" style="font-size: 13px; line-height: 1.4; color: #bdc3c7; padding: 0 16px 16px 16px; overflow-y: auto; height: calc(100% - 60px);">
                        <em>No speaker notes for this slide.</em>
                    </div>
                </div>
            </div>
            
            <!-- Network Visualization Content -->
            <div id="network-content" class="content-view" style="display: flex; flex-direction: column; position: relative;">
                <div id="network-visualization" style="width: 100%; flex: 1; min-height: 0;">
                    <!-- Unified network visualization will be rendered here -->
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
                        <div style="font-size: 24px; margin-bottom: 10px;">üîó</div>
                        <div>Loading network visualization...</div>
                    </div>
                </div>
            </div>
            
            <!-- Circle Visualization Content -->
            <div id="circle-content" class="content-view" style="display: flex; flex-direction: column; position: relative;">
                <div id="circle-export-controls" style="position: absolute; top: 10px; right: 10px; z-index: 1000;"></div>
                <div id="circle-visualization" style="width: 100%; flex: 1; min-height: 0; background: #fafafa;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
                        <div style="font-size: 24px; margin-bottom: 10px;">üîÑ</div>
                        <div>Hermeneutic Circle</div>
                        <div style="font-size: 12px; margin-top: 5px; color: #999;">Exploring iterative understanding patterns</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Find & Replace Dialog -->
    <div id="find-replace-dialog" class="hidden">
        <div class="find-replace-header">
            <span>Find & Replace</span>
            <button class="find-replace-close" id="find-replace-close">&times;</button>
        </div>
        
        <div class="find-replace-field">
            <label for="find-input">Find:</label>
            <input type="text" id="find-input" class="find-replace-input" placeholder="Enter search text">
        </div>
        
        <div class="find-replace-field">
            <label for="replace-input">Replace:</label>
            <input type="text" id="replace-input" class="find-replace-input" placeholder="Enter replacement text">
        </div>
        
        <div class="find-replace-options">
            <label class="find-replace-option">
                <input type="checkbox" id="case-sensitive"> Case sensitive
            </label>
            <label class="find-replace-option">
                <input type="checkbox" id="regex-mode"> Regex
            </label>
            <label class="find-replace-option">
                <input type="checkbox" id="whole-word"> Whole word
            </label>
        </div>
        
        <div class="find-replace-actions">
            <button class="find-replace-btn find-replace-primary" id="find-next">Find Next</button>
            <button class="find-replace-btn" id="find-previous">Find Previous</button>
            <button class="find-replace-btn" id="replace-current">Replace</button>
            <button class="find-replace-btn" id="replace-all">Replace All</button>
        </div>
        
        <div class="find-replace-stats" id="find-replace-stats">
            <!-- Stats will be populated by JavaScript -->
        </div>
    </div>

    <!-- Folder Name Modal -->
    <div id="folder-name-modal" class="hidden">
        <div class="folder-name-dialog">
            <div class="folder-name-header">Create New Folder</div>
            
            <div class="folder-name-field">
                <label for="folder-name-input">Folder name:</label>
                <input type="text" id="folder-name-input" class="folder-name-input" placeholder="Enter folder name">
                <div class="folder-name-error" id="folder-name-error"></div>
            </div>
            
            <div class="folder-name-actions">
                <button class="folder-name-btn" id="folder-name-cancel">Cancel</button>
                <button class="folder-name-btn primary" id="folder-name-create">Create</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
    // Monaco editor configuration for Electron - disable web workers to avoid file:// issues
    window.MonacoEnvironment = {
        getWorker: function (workerId, label) {
            return undefined; // Disable web workers, use main thread
        }
    };
    
    // Check if Monaco editor resources are available before loading renderer
    if (typeof require !== 'undefined') {
        // Load Monaco editor configuration
        require.config({ 
            paths: { 'vs': './node_modules/monaco-editor/min/vs' },
            'vs/nls': { availableLanguages: { '*': 'en' } }
        });
    }
    </script>
    <script src="./node_modules/monaco-editor/min/vs/loader.js" defer></script>
    
    <!-- Load modules first -->
    <script src="orchestrator/modules/internalLinks.js" defer></script>
    <script src="orchestrator/modules/annotations.js" defer></script>
    <script src="orchestrator/modules/formatting.js" defer></script>
    <script src="orchestrator/modules/aiChat.js" defer></script>
    <script src="orchestrator/modules/export.js" defer></script>
    <script src="orchestrator/modules/search.js" defer></script>
    <script src="orchestrator/modules/findReplace.js" defer></script>
    <script src="orchestrator/modules/navigation.js" defer></script>
    <script src="orchestrator/modules/commandPalette.js" defer></script>
    <script src="orchestrator/modules/kanban.js" defer></script>
    <script src="orchestrator/modules/settings.js" defer></script>
    <script src="orchestrator/modules/listManagement.js" defer></script>
    <script src="orchestrator/modules/speakerNotes.js" defer></script>
    <script src="orchestrator/modules/autosave.js" defer></script>
    <!-- D3.js v7.8.5 already loaded above with React/Babel -->
    <script src="orchestrator/modules/wholepart.js" defer></script>
    <!-- AI Assistant Configuration -->
    <script src="orchestrator/modules/ai-assistant-config.js" defer></script>
    <!-- AI Writing Companion - Modular Architecture -->
    <script src="orchestrator/modules/ai-companion/analysis/TextAnalysisEngine.js" defer></script>
    <script src="orchestrator/modules/ai-companion/context/ContextManager.js" defer></script>
    <script src="orchestrator/modules/ai-companion/feedback/FeedbackSystem.js" defer></script>
    <script src="orchestrator/modules/ai-companion/AICompanionManager.js" defer></script>
    <!-- Gamification System - Modular Architecture -->
    <script src="orchestrator/modules/gamification/core/WritingSession.js" defer></script>
    <script src="orchestrator/modules/gamification/timers/FocusTimer.js" defer></script>
    <script src="orchestrator/modules/gamification/core/FlowState.js" defer></script>
    <script src="orchestrator/modules/gamification/data/DataPersistence.js" defer></script>
    <script src="orchestrator/modules/gamification/GamificationManager.js" defer></script>
    <script src="orchestrator/modules/gamification.js" defer></script>
    <script src="orchestrator/modules/collaborative-challenges.js" defer></script>
    <script src="orchestrator/modules/challenges-ui.js" defer></script>
    <!-- AI Flow Detection - Modular System -->
    <script src="orchestrator/modules/ai-flow-detection/TextCollectionManager.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/TypingPatternAnalyzer.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/CognitiveLoadAssessment.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/FlowStateEngine.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/InsightsEngine.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/FlowIndicatorUI.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/AIFlowDetectionManager.js" defer></script>
    <script src="orchestrator/modules/ai-flow-detection/index.js" defer></script>
    <script src="orchestrator/modules/todo-gamification.js" defer></script>
    <script src="orchestrator/modules/dragdrop.js" defer></script>
    <script src="orchestrator/modules/previewZoom.js" defer></script>
    <script src="orchestrator/modules/fileFilters.js" defer></script>
    <script src="orchestrator/modules/tagManager.js" defer></script>
    <script src="orchestrator/modules/scholar-support.js" defer></script>
    <script type="module" src="orchestrator/modules/graph.js" defer></script>
    <script type="module" src="orchestrator/modules/circle.js" defer></script>
    
    <!-- Style management modules -->
    <script src="styles/style-manager.js" defer></script>
    
    <script src="styles/style-settings-ui.js" defer></script>
    
    <!-- Export visualization module -->
    <script src="orchestrator/modules/exportVisualization.js" defer></script>
    
    <!-- Main renderer script -->
    <script src="orchestrator/renderer.js" defer></script>
    
    <!-- Load compiled React components -->
    <script src="components/dist/MarkdownPreziApp.js" defer></script>
    
    <!-- Load JavaScript modules -->
    <script src="js/speaker-notes.js" defer></script>
    <script src="js/mode-switcher.js" defer></script>  
    <script src="js/network-visualization.js" defer></script>
    <script src="orchestrator/modules/unifiedNetwork.js" defer></script>
    <script src="js/editor-utils.js" defer></script>
    <script src="js/app-init.js" defer></script>
</body>
</html>